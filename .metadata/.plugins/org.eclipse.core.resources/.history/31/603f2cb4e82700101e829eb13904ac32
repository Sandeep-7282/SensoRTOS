#include "stm32f103xb.h"
#include "uart-driver.h"
#include "gpio-driver.h"
#include <string.h>

char rx_buffer[16];
uint8_t idx = 0;

int main(void) {
    UART1_Init();
    GPIO_Init();

    UART1_SendString("LED Control Ready (PA5)\r\n");

    while (1) {
        char c = UART1_ReceiveChar();

        if (c == '\r') {
            rx_buffer[idx] = '\0';  // Null-terminate command
            UART1_SendChar(c);
            if (strcmp(rx_buffer, "LED ON") == 0) {
                LED_ON();
                UART1_SendString("LED Turned ON\r\n");
            } else if (strcmp(rx_buffer, "LED OFF") == 0) {
                LED_OFF();
                UART1_SendString("LED Turned OFF\r\n");
            } else {
                UART1_SendString("Unknown Command\r\n");
            }

            idx = 0;  // Reset buffer
        } else if (idx < sizeof(rx_buffer) - 1) {
            rx_buffer[idx++] = c;
        }
    }
}
